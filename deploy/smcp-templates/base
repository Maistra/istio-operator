apiVersion: maistra.io/v1
kind: ServiceMeshControlPlane
spec:
  istio:
    global:
      tag: 1.0.2
      # constrain resources for use in smaller environments
      defaultResources:
        requests:
          cpu: 50m
          memory: 128Mi
        limits:
          cpu: 50m
          memory: 256Mi
      proxy:
        autoInject: disabled
        dnsRefreshRate: 300s
        # constrain resources for use in smaller environments
        resources:
          requests:
            cpu: 50m
            memory: 128Mi
          limits:
            cpu: 50m
            memory: 256Mi
      oauthproxy:
        tag: 4.1
        imagePullPolicy: IfNotPresent
      defaultPodDisruptionBudget:
        enabled: false
    security:
      # constrain resources for use in smaller environments
      resources:
        requests:
          cpu: 100m
          memory: 128Mi
        limits:
          cpu: 100m
          memory: 256Mi
    galley:
      # constrain resources for use in smaller environments
      resources:
        requests:
          cpu: 100m
          memory: 128Mi
        limits:
          cpu: 100m
          memory: 256Mi
    pilot:
      resources:
        requests:
          cpu: 100m
          memory: 128Mi
        limits:
          cpu: 100m
          memory: 256Mi
      env:
        GODEBUG: null
    mixer:
      telemetry:
        # constrain resources for use in smaller environments
        resources:
          requests:
            cpu: 50m
            memory: 128Mi
          limits:
            cpu: 50m
            memory: 256Mi
      env:
        GODEBUG: null
    grafana:
      enabled: true
      ingress:
        enabled: true
      service:
        annotations:
           service.alpha.openshift.io/serving-cert-secret-name: grafana-tls
    tracing:
      enabled: true
      ingress:
        enabled: true
    kiali:
      enabled: true
      dashboard:
        viewOnlyMode: false
      ingress:
        enabled: true
    sidecarInjectorWebhook:
      enableNamespacesByDefault: true
    gateways:
      istio-egressgateway:
        enabled: true
        # constrain resources for use in smaller environments
        resources:
          requests:
            cpu: 50m
            memory: 128Mi
          limits:
            cpu: 50m
            memory: 256Mi
      istio-ingressgateway:
        enabled: true
        type: ClusterIP
        # constrain resources for use in smaller environments
        resources:
          requests:
            cpu: 50m
            memory: 128Mi
          limits:
            cpu: 50m
            memory: 256Mi
    prometheus:
      service:
        annotations:
          service.alpha.openshift.io/serving-cert-secret-name: prometheus-tls
      ingress:
        enabled: true
      # constrain resources for use in smaller environments
      resources:
        requests:
          cpu: 50m
          memory: 128Mi
        limits:
          cpu: 50m
          memory: 512Mi
  threeScale: {}
