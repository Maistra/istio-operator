# Autogenerated from files in deploy/src by generate-manifests.sh
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: servicemeshcontrolplanes.maistra.io
spec:
  group: maistra.io
  names:
    kind: ServiceMeshControlPlane
    listKind: ServiceMeshControlPlaneList
    plural: servicemeshcontrolplanes
    shortNames:
    - smcp
    singular: servicemeshcontrolplane
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: How many of the total number of components are ready
      jsonPath: .status.annotations.readyComponentCount
      name: Ready
      type: string
    - description: Whether or not the control plane installation is up to date and
        ready to handle requests.
      jsonPath: .status.conditions[?(@.type=="Ready")].reason
      name: Status
      type: string
    - description: The configuration template to use as the base.
      jsonPath: .status.lastAppliedConfiguration.template
      name: Template
      type: string
    - description: The actual current version of the control plane installation.
      jsonPath: .status.lastAppliedConfiguration.version
      name: Version
      type: string
    - description: The age of the object
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    - description: The image hub used as the base for all component images.
      jsonPath: .status.lastAppliedConfiguration.istio.global.hub
      name: Image HUB
      priority: 1
      type: string
    name: v1
    schema:
      openAPIV3Schema:
        description: ServiceMeshControlPlane represents a deployment of the service
          mesh control plane. The control plane components are deployed in the namespace
          in which the ServiceMeshControlPlane resides. The configuration options
          for the components that comprise the control plane are specified in this
          object.
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: The specification of the desired state of this ServiceMeshControlPlane.
              This includes the configuration options for all components that comprise
              the control plane.
            properties:
              istio:
                description: 'Specifies the Istio configuration options that are passed
                  to Helm when the Istio charts are rendered. These options are usually
                  populated from the template specified in the spec.template field,
                  but individual values can be overridden here. More info: https://maistra.io/docs/installation/installation-options/'
                type: object
                x-kubernetes-preserve-unknown-fields: true
              networkType:
                description: 'DEPRECATED: No longer used anywhere. Previously used
                  to specify the NetworkType of the cluster. Defaults to "subnet".'
                type: string
              template:
                description: Template selects the template to use for default values.
                  Defaults to "default" when not set.
                type: string
              threeScale:
                description: 'Specifies the 3Scale configuration options that are
                  passed to Helm when the 3Scale charts are rendered. These values
                  are usually populated from the template specified in the spec.template
                  field, but individual values can be overridden here. More info:
                  https://maistra.io/docs/installation/installation-options/#_3scale'
                type: object
                x-kubernetes-preserve-unknown-fields: true
              version:
                description: Version specifies what Maistra version of the control
                  plane to install. When creating a new ServiceMeshControlPlane with
                  an empty version, the admission webhook sets the version to the
                  latest version supported by the operator. Existing ServiceMeshControlPlanes
                  with an empty version are treated as having the version set to "v1.0"
                type: string
            type: object
          status:
            description: The current status of this ServiceMeshControlPlane and the
              components that comprise the control plane. This data may be out of
              date by some window of time.
            properties:
              annotations:
                additionalProperties:
                  type: string
                description: Annotations is an unstructured key value map used to
                  store additional, usually redundant status information, such as
                  the number of components deployed by the ServiceMeshControlPlane
                  (number is redundant because you could just as easily count the
                  elements in the ComponentStatus array). The reason to add this redundant
                  information is to make it available to kubectl, which does not yet
                  allow counting objects in JSONPath expressions.
                type: object
              components:
                description: The list of components comprising the control plane and
                  their statuses.
                items:
                  description: ComponentStatus represents the status of an object
                    with children
                  properties:
                    children:
                      description: 'TODO: can we remove this? it''s not used anywhere
                        The status of each resource that comprises this component.'
                      items:
                        description: StatusType represents the status for a control
                          plane, component, or resource
                        properties:
                          conditions:
                            description: Represents the latest available observations
                              of the object's current state.
                            items:
                              description: A Condition represents a specific observation
                                of the object's state.
                              properties:
                                lastTransitionTime:
                                  description: Last time the condition transitioned
                                    from one status to another.
                                  format: date-time
                                  type: string
                                message:
                                  description: Human-readable message indicating details
                                    about the last transition.
                                  type: string
                                reason:
                                  description: Unique, single-word, CamelCase reason
                                    for the condition's last transition.
                                  type: string
                                status:
                                  description: The status of this condition. Can be
                                    True, False or Unknown.
                                  type: string
                                type:
                                  description: The type of this condition.
                                  type: string
                              type: object
                            type: array
                        type: object
                      type: array
                    conditions:
                      description: Represents the latest available observations of
                        the object's current state.
                      items:
                        description: A Condition represents a specific observation
                          of the object's state.
                        properties:
                          lastTransitionTime:
                            description: Last time the condition transitioned from
                              one status to another.
                            format: date-time
                            type: string
                          message:
                            description: Human-readable message indicating details
                              about the last transition.
                            type: string
                          reason:
                            description: Unique, single-word, CamelCase reason for
                              the condition's last transition.
                            type: string
                          status:
                            description: The status of this condition. Can be True,
                              False or Unknown.
                            type: string
                          type:
                            description: The type of this condition.
                            type: string
                        type: object
                      type: array
                    resource:
                      description: The name of the component this status pertains
                        to.
                      type: string
                  type: object
                nullable: true
                type: array
              conditions:
                description: Represents the latest available observations of the object's
                  current state.
                items:
                  description: A Condition represents a specific observation of the
                    object's state.
                  properties:
                    lastTransitionTime:
                      description: Last time the condition transitioned from one status
                        to another.
                      format: date-time
                      type: string
                    message:
                      description: Human-readable message indicating details about
                        the last transition.
                      type: string
                    reason:
                      description: Unique, single-word, CamelCase reason for the condition's
                        last transition.
                      type: string
                    status:
                      description: The status of this condition. Can be True, False
                        or Unknown.
                      type: string
                    type:
                      description: The type of this condition.
                      type: string
                  type: object
                type: array
              lastAppliedConfiguration:
                description: The full specification of the configuration options that
                  were applied to the components of the control plane during the most
                  recent reconciliation.
                properties:
                  istio:
                    description: 'Specifies the Istio configuration options that are
                      passed to Helm when the Istio charts are rendered. These options
                      are usually populated from the template specified in the spec.template
                      field, but individual values can be overridden here. More info:
                      https://maistra.io/docs/installation/installation-options/'
                    type: object
                    x-kubernetes-preserve-unknown-fields: true
                  networkType:
                    description: 'DEPRECATED: No longer used anywhere. Previously
                      used to specify the NetworkType of the cluster. Defaults to
                      "subnet".'
                    type: string
                  template:
                    description: Template selects the template to use for default
                      values. Defaults to "default" when not set.
                    type: string
                  threeScale:
                    description: 'Specifies the 3Scale configuration options that
                      are passed to Helm when the 3Scale charts are rendered. These
                      values are usually populated from the template specified in
                      the spec.template field, but individual values can be overridden
                      here. More info: https://maistra.io/docs/installation/installation-options/#_3scale'
                    type: object
                    x-kubernetes-preserve-unknown-fields: true
                  version:
                    description: Version specifies what Maistra version of the control
                      plane to install. When creating a new ServiceMeshControlPlane
                      with an empty version, the admission webhook sets the version
                      to the latest version supported by the operator. Existing ServiceMeshControlPlanes
                      with an empty version are treated as having the version set
                      to "v1.0"
                    type: string
                type: object
              observedGeneration:
                description: The generation observed by the controller during the
                  most recent reconciliation. The information in the status pertains
                  to this particular generation of the object.
                format: int64
                type: integer
              reconciledVersion:
                description: The last version that was reconciled.
                type: string
            required:
            - components
            - lastAppliedConfiguration
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}

---

apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: servicemeshmemberrolls.maistra.io
spec:
  group: maistra.io
  names:
    kind: ServiceMeshMemberRoll
    listKind: ServiceMeshMemberRollList
    plural: servicemeshmemberrolls
    shortNames:
    - smmr
    singular: servicemeshmemberroll
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: How many of the total number of member namespaces are configured
      jsonPath: .status.annotations.configuredMemberCount
      name: Ready
      type: string
    - description: Whether all member namespaces have been configured or why that's
        not the case
      jsonPath: .status.conditions[?(@.type=="Ready")].reason
      name: Status
      type: string
    - description: The age of the object
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    - description: Namespaces that are members of this Control Plane
      jsonPath: .spec.members
      name: Members
      priority: 1
      type: string
    name: v1
    schema:
      openAPIV3Schema:
        description: The ServiceMeshMemberRoll object configures which namespaces
          belong to a service mesh. Only namespaces listed in the ServiceMeshMemberRoll
          will be affected by the control plane. Any number of namespaces can be added,
          but a namespace may not exist in more than one service mesh. The ServiceMeshMemberRoll
          object must be created in the same namespace as the ServiceMeshControlPlane
          object and must be named "default".
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: Specification of the desired list of members of the service
              mesh.
            properties:
              members:
                description: ' List of namespaces that should be members of the service
                  mesh.'
                items:
                  type: string
                nullable: true
                type: array
            type: object
          status:
            description: The current status of this ServiceMeshMemberRoll. This data
              may be out of date by some window of time.
            properties:
              annotations:
                additionalProperties:
                  type: string
                description: Annotations is an unstructured key value map used to
                  store additional, usually redundant status information, such as
                  the number of components deployed by the ServiceMeshControlPlane
                  (number is redundant because you could just as easily count the
                  elements in the ComponentStatus array). The reason to add this redundant
                  information is to make it available to kubectl, which does not yet
                  allow counting objects in JSONPath expressions.
                type: object
              conditions:
                description: Represents the latest available observations of this
                  ServiceMeshMemberRoll's current state.
                items:
                  description: Condition represents a specific condition on a resource
                  properties:
                    lastTransitionTime:
                      format: date-time
                      type: string
                    message:
                      type: string
                    reason:
                      type: string
                    status:
                      type: string
                    type:
                      description: 'ServiceMeshMemberRollConditionType represents
                        the type of the condition.  Condition types are: Reconciled,
                        NamespaceConfigured'
                      type: string
                  type: object
                nullable: true
                type: array
              configuredMembers:
                description: List of namespaces that are configured as members of
                  the service mesh.
                items:
                  type: string
                nullable: true
                type: array
              meshGeneration:
                description: The generation of the ServiceMeshControlPlane object
                  observed by the controller during the most recent reconciliation
                  of this ServiceMeshMemberRoll.
                format: int64
                type: integer
              meshReconciledVersion:
                description: The reconciled version of the ServiceMeshControlPlane
                  object observed by the controller during the most recent reconciliation
                  of this ServiceMeshMemberRoll.
                type: string
              observedGeneration:
                description: The generation observed by the controller during the
                  most recent reconciliation. The information in the status pertains
                  to this particular generation of the object.
                format: int64
                type: integer
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}

---

apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: servicemeshmembers.maistra.io
spec:
  group: maistra.io
  names:
    kind: ServiceMeshMember
    listKind: ServiceMeshMemberList
    plural: servicemeshmembers
    shortNames:
    - smm
    singular: servicemeshmember
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: The ServiceMeshControlPlane this namespace belongs to
      jsonPath: .status.annotations.controlPlaneRef
      name: Control Plane
      type: string
    - description: Whether or not namespace is configured as a member of the mesh.
      jsonPath: .status.conditions[?(@.type=="Ready")].status
      name: Ready
      type: string
    - description: The age of the object
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1
    schema:
      openAPIV3Schema:
        description: "A ServiceMeshMember object marks the namespace in which it lives
          as a member of the Service Mesh Control Plane referenced in the object.
          The ServiceMeshMember object should be created in each application namespace
          that must be part of the service mesh and must be named \"default\". \n
          When the ServiceMeshMember object is created, it causes the namespace to
          be added to the ServiceMeshMemberRoll within the namespace of the ServiceMeshControlPlane
          object the ServiceMeshMember references. \n To reference a ServiceMeshControlPlane,
          the user creating the ServiceMeshMember object must have the \"use\" permission
          on the referenced ServiceMeshControlPlane object. This permission is given
          via the mesh-users RoleBinding (and mesh-user Role) in the namespace of
          the referenced ServiceMeshControlPlane object."
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: The desired state of this ServiceMeshMember.
            properties:
              controlPlaneRef:
                description: A reference to the ServiceMeshControlPlane object.
                properties:
                  name:
                    description: The name of the referenced ServiceMeshControlPlane
                      object.
                    type: string
                  namespace:
                    description: The namespace of the referenced ServiceMeshControlPlane
                      object.
                    type: string
                required:
                - name
                - namespace
                type: object
            required:
            - controlPlaneRef
            type: object
          status:
            description: The current status of this ServiceMeshMember. This data may
              be out of date by some window of time.
            properties:
              annotations:
                additionalProperties:
                  type: string
                description: Annotations is an unstructured key value map used to
                  store additional, usually redundant status information, such as
                  the number of components deployed by the ServiceMeshControlPlane
                  (number is redundant because you could just as easily count the
                  elements in the ComponentStatus array). The reason to add this redundant
                  information is to make it available to kubectl, which does not yet
                  allow counting objects in JSONPath expressions.
                type: object
              conditions:
                description: Represents the latest available observations of a ServiceMeshMember's
                  current state.
                items:
                  description: Condition represents a specific condition on a resource
                  properties:
                    lastTransitionTime:
                      format: date-time
                      type: string
                    message:
                      type: string
                    reason:
                      type: string
                    status:
                      type: string
                    type:
                      description: 'ServiceMeshMemberConditionType represents the
                        type of the condition.  Condition types are: Reconciled, NamespaceConfigured'
                      type: string
                  type: object
                type: array
              observedGeneration:
                description: The generation observed by the controller during the
                  most recent reconciliation. The information in the status pertains
                  to this particular generation of the object.
                format: int64
                type: integer
            required:
            - conditions
            - observedGeneration
            type: object
        required:
        - spec
        type: object
    served: true
    storage: true
    subresources:
      status: {}

---

# create role that can be used to grant users permission to create smcp and smmr resources
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: maistra-admin
  labels:
    rbac.authorization.k8s.io/aggregate-to-admin: "true"
rules:
- apiGroups: ["maistra.io"]
  resources: ["*"]
  verbs: ["*"]

---

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: maistra-admin
roleRef:
  kind: ClusterRole
  apiGroup: rbac.authorization.k8s.io
  name: maistra-admin

---

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: istio-operator
rules:
# operator-sdk rules
- apiGroups:
  - monitoring.coreos.com
  resources:
  - servicemonitors
  verbs:
  - "get"
  - "create"
- apiGroups:
  - ""
  resources:
  - services/finalizers
  verbs:
  - '*'

# operator rules for managing istio
- apiGroups:
  - ""
  resources:
  - configmaps
  - endpoints
  - namespaces
  - persistentvolumeclaims
  - pods
  - replicationcontrollers
  - secrets
  - serviceaccounts
  - services
  - events # is this needed?
  verbs:
  - '*'
- apiGroups:
  - apps
  - extensions
  resources:
  - daemonsets
  - deployments
  - deployments/finalizers
  - ingresses # is this needed? should it be converted to a route?
  - ingresses/status
  - replicasets
  - statefulsets
  verbs:
  - '*'
- apiGroups:
  - autoscaling
  resources:
  - horizontalpodautoscalers
  verbs:
  - '*'
- apiGroups:
  - policy
  resources:
  - poddisruptionbudgets
  verbs:
  - '*'
- apiGroups:
  - admissionregistration.k8s.io
  resources:
  - mutatingwebhookconfigurations
  - validatingwebhookconfigurations
  verbs:
  - '*'
- apiGroups:
  - apiextensions.k8s.io
  resources:
  - customresourcedefinitions
  verbs:
  - '*'
- apiGroups:
  - certmanager.k8s.io
  resources:
  - clusterissuers
  verbs:
  - '*'
- apiGroups:
  - networking.k8s.io
  resources:
  - networkpolicies
  verbs:
  - '*'
- apiGroups:
  - rbac.authorization.k8s.io
  resources:
  - clusterrolebindings
  - clusterroles
  - rolebindings
  - roles
  verbs:
  - '*'
- apiGroups:
  - authentication.istio.io
  resources:
  - '*'
  verbs:
  - '*'
- apiGroups:
  - config.istio.io
  resources:
  - '*'
  verbs:
  - '*'
- apiGroups:
  - networking.istio.io
  resources:
  - '*'
  verbs:
  - '*'
- apiGroups:
  - rbac.istio.io
  resources:
  - '*'
  verbs:
  - '*'
- apiGroups:
  - security.istio.io
  resources:
  - '*'
  verbs:
  - '*'
- apiGroups:
  - jaegertracing.io
  resources:
  - jaegers
  verbs:
  - '*'
- apiGroups:
  - kiali.io
  resources:
  - kialis
  verbs:
  - '*'
- apiGroups:
  - maistra.io
  resources:
  - '*'
  verbs:
  - '*'
- apiGroups:
  - authentication.maistra.io
  resources:
  - '*'
  verbs:
  - '*'
- apiGroups:
  - rbac.maistra.io
  resources:
  - '*'
  verbs:
  - '*'
- apiGroups:
  - route.openshift.io
  resources:
  - routes
  - routes/custom-host
  verbs:
  - '*'
# required by smmr controller
- apiGroups:
  - authorization.k8s.io
  resources:
  - subjectaccessreviews
  verbs:
  - create
- apiGroups:
  - network.openshift.io
  resources:
  - clusternetworks
  verbs:
  - get
- apiGroups:
  - config.openshift.io
  resources:
  - networks
  verbs:
  - get
- apiGroups:
  - image.openshift.io
  resources:
  - imagestreams
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - network.openshift.io
  resources:
  - netnamespaces
  verbs:
  - get
  - list
  - watch
  - update
- apiGroups:
  - k8s.cni.cncf.io
  resources:
  - network-attachment-definitions
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - watch

# required by cni daemonset
- apiGroups:
  - security.openshift.io
  resources:
  - securitycontextconstraints
  resourceNames:
  - privileged
  verbs:
  - use

# required by pod locality controller
- apiGroups:
  - ""
  resources:
  - nodes
  - nodes/proxy
  verbs:
  - get
  - list
  - watch
- apiGroups: # might be required by citadel
  - authentication.k8s.io
  resources:
  - tokenreviews
  verbs:
  - create
- nonResourceURLs:
  - '/metrics'
  verbs:
  - get

---

kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1beta1
metadata:
  name: istio-operator-account-istio-operator-cluster-role-binding
subjects:
- kind: ServiceAccount
  namespace: istio-operator
  name: istio-operator
roleRef:
  kind: ClusterRole
  name: istio-operator
  apiGroup: rbac.authorization.k8s.io

---

apiVersion: v1
kind: ServiceAccount
metadata:
  name: istio-operator
  namespace: istio-operator

---

apiVersion: v1
kind: Service
metadata:
  name: maistra-admission-controller
  namespace: istio-operator
  annotations:
    service.beta.openshift.io/serving-cert-secret-name: maistra-operator-serving-cert
spec:
  ports:
  - port: 443
    protocol: TCP
    targetPort: 11999
  selector:
    name: istio-operator
  type: ClusterIP

---

apiVersion: apps/v1
kind: Deployment
metadata:
  name: istio-operator
  namespace: istio-operator
spec:
  replicas: 1
  selector:
    matchLabels:
      name: istio-operator
  template:
    metadata:
      labels:
        name: istio-operator
      annotations:
        olm.relatedImage.v1_0.3scale-istio-adapter: quay.io/3scale/3scale-istio-adapter:v1.0.0
        olm.relatedImage.v1_0.citadel: docker.io/maistra/citadel-ubi8:1.0.8
        olm.relatedImage.v1_0.cni: docker.io/maistra/istio-cni-ubi8:1.0.8
        olm.relatedImage.v1_0.galley: docker.io/maistra/galley-ubi8:1.0.8
        olm.relatedImage.v1_0.grafana: docker.io/maistra/grafana-ubi8:1.0.8
        olm.relatedImage.v1_0.mixer: docker.io/maistra/mixer-ubi8:1.0.8
        olm.relatedImage.v1_0.pilot: docker.io/maistra/pilot-ubi8:1.0.8
        olm.relatedImage.v1_0.prometheus: docker.io/maistra/prometheus-ubi8:1.0.8
        olm.relatedImage.v1_0.proxy-init: docker.io/maistra/proxy-init-centos7:1.0.8
        olm.relatedImage.v1_0.proxyv2: docker.io/maistra/proxyv2-ubi8:1.0.8
        olm.relatedImage.v1_0.sidecar-injector: docker.io/maistra/sidecar-injector-ubi8:1.0.8

        olm.relatedImage.v1_1.3scale-istio-adapter: quay.io/3scale/3scale-istio-adapter:v1.0.0
        olm.relatedImage.v1_1.citadel: docker.io/maistra/citadel-ubi8:1.1.3
        olm.relatedImage.v1_1.cni: docker.io/maistra/istio-cni-ubi8:1.1.3
        olm.relatedImage.v1_1.galley: docker.io/maistra/galley-ubi8:1.1.3
        olm.relatedImage.v1_1.grafana: docker.io/maistra/grafana-ubi8:1.1.3
        olm.relatedImage.v1_1.ior: docker.io/maistra/istio-ior-ubi8:1.1.3
        olm.relatedImage.v1_1.mixer: docker.io/maistra/mixer-ubi8:1.1.3
        olm.relatedImage.v1_1.pilot: docker.io/maistra/pilot-ubi8:1.1.3
        olm.relatedImage.v1_1.prometheus: docker.io/maistra/prometheus-ubi8:1.1.3
        olm.relatedImage.v1_1.proxy-init: docker.io/maistra/proxy-init-centos7:1.1.3
        olm.relatedImage.v1_1.proxyv2: docker.io/maistra/proxyv2-ubi8:1.1.3
        olm.relatedImage.v1_1.sidecar-injector: docker.io/maistra/sidecar-injector-ubi8:1.1.3

        olm.relatedImage.v1_2.3scale-istio-adapter: quay.io/3scale/3scale-istio-adapter:v1.0.0
        olm.relatedImage.v1_2.citadel: docker.io/maistra/citadel-ubi8:1.2.0
        olm.relatedImage.v1_2.cni: docker.io/maistra/istio-cni-ubi8:1.2.0
        olm.relatedImage.v1_2.galley: docker.io/maistra/galley-ubi8:1.2.0
        olm.relatedImage.v1_2.grafana: docker.io/maistra/grafana-ubi8:1.2.0
        olm.relatedImage.v1_2.ior: docker.io/maistra/istio-ior-ubi8:1.2.0
        olm.relatedImage.v1_2.mixer: docker.io/maistra/mixer-ubi8:1.2.0
        olm.relatedImage.v1_2.pilot: docker.io/maistra/pilot-ubi8:1.2.0
        olm.relatedImage.v1_2.prometheus: docker.io/maistra/prometheus-ubi8:1.2.0
        olm.relatedImage.v1_2.proxy-init: docker.io/maistra/proxy-init-centos7:1.2.0
        olm.relatedImage.v1_2.proxyv2: docker.io/maistra/proxyv2-ubi8:1.2.0
        olm.relatedImage.v1_2.sidecar-injector: docker.io/maistra/sidecar-injector-ubi8:1.2.0
    spec:
      serviceAccountName: istio-operator
      containers:
      - name: istio-operator
        image: maistra/istio-ubi8-operator:1.2.0
        ports:
        - containerPort: 11999
          name: validation
        - containerPort: 60000
          name: metrics
        command:
        - istio-operator
        - --config
        - /etc/operator/olm/config.properties
        imagePullPolicy: Always
        env:
        - name: WATCH_NAMESPACE
          value: ""
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: OPERATOR_NAME
          value: istio-operator
#        - name: ISTIO_CNI_IMAGE_PULL_SECRET
#          value: name-of-secret
        volumeMounts:
        - name: operator-olm-config
          mountPath: /etc/operator/olm
          readOnly: true
        - name: webhook-tls-volume
          readOnly: true
          mountPath: /tmp/k8s-webhook-server/serving-certs
      volumes:
      - name: operator-olm-config
        downwardAPI:
          defaultMode: 420
          items:
          - fieldRef:
              fieldPath: metadata.annotations
            path: config.properties
      - name: webhook-tls-volume
        secret:
          secretName: maistra-operator-serving-cert
          optional: true # this won't be available until service-ca creates the secret